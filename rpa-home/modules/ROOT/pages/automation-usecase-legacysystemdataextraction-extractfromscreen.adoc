# Interacting with a Screen of a Legacy Application

// number the headings to correspond to the numbered list of steps
:sectnums:

With the order ID, you can now get the corresponding tracking number from the legacy system:

. Run your legacy application.
. Search for the word `Order-ID` on the screen, click in the edit field next to it, enter the order ID, and click *Search*.
. If there is a result, copy the tracking number to the activity parameter and set the gateway variable `is_orderid_found` to true. If there is no result, set the gateway variable `is_orderid_found` to false.

image::usecase-legacysystem-screeninteraction.png["The Workflow contains the steps in form of Action Steps. Some of the Action Steps are nested."]

## Run a Legacy Desktop Application

To run the legacy desktop order-tracking application, select the path to the executable file in the *Run program* Action Step. You set the start mode of the application to `Maximized` to open the application in a maximized window. This process ensures that the UI elements are always in the same position on the screen, which is important because you later use Action Steps that work with screen coordinates. You select `Wait for Window to appear` and specify the window title to ensure that the following Action Steps won't return an error because the window isn't there yet.

image::usecase-legacysystem-screeninteraction-run.png[]

## Enter Text Into a Screen Element and Click a Button

To search for the tracking number, you have to enter the order ID in the search field and click the search button.

To find the search field, you need to find the word `Order ID` next to it on the application screen first. You use the *Search Pattern* Action Step to capture and compare the pattern:

image::usecase-legacysystem-screeninteraction-capturepattern.png["When you capture a pattern, the screen freezes. You draw a box around the pattern and the search area on the frozen screen."]

image::usecase-legacysystem-screeninteraction-searchpattern.png[]

Finding the pattern returns a coordinate that you use in the next step to determine where to input the order ID. You use the *Mouse Action* Action Step to click the search field next to the `Order ID` label.

image:usecase-legacysystem-screeninteraction-mouseaction.png["The coordinates from the found pattern are used in the Relative To field of the Mouse Action Action Step."]

The search field now has the focus, so you can enter the order ID with a simulated keyboard. Instead of recording keystrokes, you use the Activity Parameter `order_id` with the *Enter String* Action Step to copy the order ID into the field:

image::usecase-legacysystem-screeninteraction-enterstring.png[]

You use *Mouse Action* again to start the search. To determine the position of the search button to click, you reuse the location of the `Order id` pattern to record the click position.

image::usecase-legacysystem-screeninteraction-mouseaction-clickbutton.png[]

## Check the Results

You know that the search is successful when there is a result listed. As you can see on xref:automation-usecase-legacysystemdataextraction.adoc#trackingsystem-allentries-image[the screen], the tracking number should be listed in the column of the same name, so you search for that column first, using `Tracking No.` as the search pattern:

image::usecase-legacysystem-screeninteraction-searchpattern-text.png[]

Because the order might not have a corresponding tracking number in the system and you don't want to falsely return the initial value of the variable as tracking number, you check this case first using the *Managed* Action Step.

In *DoAction*, which works like a try element, you check if the result list is empty. As you can see on xref:automation-usecase-legacysystemdataextraction.adoc#trackingsystem-noentries-image[the screen], in case of no results, an up arrow is shown directly below the empty space where the results should have been.

You use the *Search Pattern* Action Step to search for this arrow up symbol and limit the search area to the space directly below the column name.

If the bot doesn't find the pattern, which means that the system found a corresponding tracking number, *Search Pattern* returns an error. To continue the workflow, you must force an OK state in the *OnError* section.

image::usecase-legacysystem-screeninteraction-searchpattern-relatedcoordinates.png[]

If the legacy application returns the tracking number, the number of found patterns matching the arrow up symbol is zero. You use this information as a case differentiator in the *Select Case* Action Step.

image::usecase-legacysystem-screeninteraction-selectcase.png["The Select Case Action Step uses Found Matched Pattern Count as Pin Variable Found Matched Pattern Count. The case compares the value to zero."]

If there is a result, you set the gateway variable `is_orderid_found` to `true`.

image::usecase-legacysystem-screeninteraction-selectcase-orderfoundtrue.png[""]

Then, you use AI-enhanced optical character recognition to extract the tracking number with the *AI OCR (screen-based)* Action Step using the `Recognition Only` search mode.

image::usecase-legacysystem-screeninteraction-aiocr.png[]

As before, you use the pattern `Tracking No.` as the anchor for the search area.

image::usecase-legacysystem-screeninteraction-trackingno-searcharea.png[]

You save the extracted tracking number to the Activity Parameter so you can return it at the end of the process.

image::usecase-legacysystem-screeninteraction-getregocnizedtext.png["The text returned by the OCR Action Step is stored in the Pin Variable named Recognized Text."]

If the tracking number is not returned by the search, you set the gateway variable `is_orderid_found` to `false` and force an OK state to continue the process.

// Turn off section numbering
:sectnums!:

## Next Activity

* xref:automation-usecase-legacysystemdataextraction-reacttodifferentoutcomes.adoc[]

## See Also

// Features of RPA Manager and RPA Builder used in this topic
* xref:rpa-builder::toolbox-control-run-program.adoc[RPA Builder Action Step: Run Program]
* xref:rpa-builder::toolbox-checks-search-pattern.adoc[RPA Builder Action Step: Search Pattern]
* xref:rpa-builder::toolbox-control-mouse-actions.adoc[RPA Builder Action Step: Mouse Actions]
* xref:rpa-builder::toolbox-control-enter-string.adoc[RPA Builder Action Step: Enter String]
* xref:rpa-builder::toolbox-flow-control-managed.adoc[RPA Builder Action Step: Managed]
* xref:rpa-builder::toolbox-flow-control-select-case.adoc[RPA Builder Action Step: Select Case]
* xref:rpa-builder::toolbox-text-recognition-ai-ocr-screen-based.adoc[RPA Builder Action Step: AI OCR (Screen-Based)]
* xref:rpa-builder::toolbox-variable-handling-set-variable.adoc[RPA Builder Action Step: Set Variable]
