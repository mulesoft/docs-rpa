# Implement the order ID extraction activity
:sectnums:

First, you need to find the order ID in the PDF.

As you can see in xref:automation-usecase-legacysystemdataextraction.adoc#confirmationletter-image[the image of the order confirmation letter], the order ID is always listed in a table next to the entry 'Order ID'. 
// Do we need an image of that part of the letter here?
You can use this information to implement the workflow containing the following steps:

. Copy the content of the order confirmation to a text file.
. Read the text file line by line to find the one containing the order ID.
. Check if the order ID is found
. Cut the order ID out from the text and store it in an activity parameter.

image::usecase-legacysystem-extractformpdf-workflow-overview.png[Overview of the workflow of the activity for the extraction of the order ID from a PDF. The number of the steps are contained in frames.]

## Copying Text From a PDF to a Text File

To copy the text content from a PDF to a text file, you open the PDF and use the outgoing Pin Variable `ReadText` as input for the 'Write to Text File' Action Step.

image::usecase-legacysystem-extractformpdf-workflow-pdftotxt.png['The part of the workflow that copies the text from a PDF to a text file is framed. The wizard for the Write To Text File action step is open with a frame around the Pin Variable containing the text extracted from the PDF by the previous action step.']

The following image shows the result of storing the text content:

image::extractorderid-workflow-resultpdftotxt.png['', 75%]

## Looping Over All Lines of a Text File

To loop over all lines of a file, you use and configure the following Action Steps:

. Count the lines of the file by reading it once:
+
*Read from Text File*
+
Read whole file
. Read the lines of the text file one after the other:
+
*Loop*
+
Use `1` as starting value and the pinned line count from the previous step as maximum value for the iteration counter.
+
image::/Users/seberhard/Projects/ExamplesForDocs/ExtractIDFromPDFAndAS400/workflow-loopoveralllinesoftextfile.png['', 75%]
+
*Read from Text File*
+
The iteration counter doubles as the number of the current line to read.
+
image::workflow-readsinglelineoftextfileinloop.png['', 50%]


## Check a Case and Catch Errors

To check for the order id, you use the following Action Steps in each iteration of the loop:

. Check if the term 'Order ID' is contained in the current line of the text file:
+
*Select case*
+
One case comparing two strings: any part of the line and 'Order ID'. If they match, you have found the line containing the order ID.
+
image::workflow-checkcase-comparesubstring.png['']
+ 
If not, you need to catch this error so that the loop continues:
+
*Force OK State*

### 3. Retrieve a Substring

Since you know that the order ID is found after the text `Order ID `, you can simply remove these first nine characters from the current line (which contains the substring `Order ID`). The remaining string is the order ID, which you store in the Activity Parameter of the same name.

For this purpose you use and configure the follwing Action Steps:

. *String Operations*:
+
* Current line as Pin variable
* `Trim left (remove first characters)`
* `9`
. *Set Variable*:
+ 
* Pin Activity Parameter
* Pin Result of String Operation

image::workflow-cutsubstringoutoftext.png['']

## Next Activitiy

...
